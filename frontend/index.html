<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Catalog</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

<!-- Top navigation -->
<header class="topnav">
  <div class="brand">story.</div>
  <nav class="links">
    <a href="#">Women</a>
    <a href="#">Men</a>
    <a href="#">Kids</a>
    <a href="#">Brands</a>
    <a href="#">New In</a>
  </nav>
  <div class="actions">
    <button class="icon" aria-label="Account">üßë</button>
    <button class="icon" aria-label="Search">üîç</button>
    <button class="icon" aria-label="Cart">üõçÔ∏è</button>
  </div>
</header>

<!-- Hero (uses frontend/Picture1.png) -->
<section class="hero">
  <div class="hero-inner">
    <h1>FALL INTO WINTER</h1>
    <h2>CAN YOU FEEL IT?</h2>
    <div class="hero-cta">
      <button class="pill" data-cat="Kids">KIDS</button>
      <button class="pill" data-cat="Men">MEN</button>
      <button class="pill" data-cat="Women">WOMEN</button>
    </div>
  </div>
</section>

<main class="wrap">
  <aside class="side">
    <h2>Categories</h2>
    <div id="cats" class="cats"></div>
  </aside>

  <section class="content">
    <div class="controls">
      <input id="search" placeholder="Search by name / brand / location" />
      <span id="count"></span>
      <div class="pager">
        <button id="prev">‚Äπ Prev</button>
        <button id="next">Next ‚Ä∫</button>
      </div>
    </div>

    <div id="grid" class="grid"></div>
  </section>
</main>

<footer class="foot">Live data from API</footer>

<script>
  const API = ""; // same-origin
  let state = { q:"", category:null, offset:0, limit:24 };

  const el  = s => document.querySelector(s);
  const fmt = s => s || "‚Äî";

  async function j(u){
    const r = await fetch(u);
    if(!r.ok) throw new Error(r.status + " " + r.statusText);
    return r.json();
  }

  async function loadCats(){
    const cats = await j(`${API}/api/categories`);
    const all = [{category:"All items", count: cats.reduce((a,c)=>a+c.count,0), _all:true}];
    const list = all.concat(cats);
    el("#cats").innerHTML = list.map(c => `
      <button class="chip ${state.category=== (c._all? null : c.category) ? "active":""}"
              data-val="${c._all ? "" : c.category}">
        ${c.category} <span class="cnt">${c.count}</span>
      </button>
    `).join("");
    el("#cats").querySelectorAll(".chip").forEach(b=>{
      b.onclick = ()=>{
        state.category = b.dataset.val || null;
        state.offset = 0;
        render();
      };
    });
  }

  async function loadItems(){
    const p = new URLSearchParams();
    if(state.q)         p.set('q', state.q);
    if(state.category)  p.set('category', state.category);
    p.set('limit',  state.limit);
    p.set('offset', state.offset);
    return j(`${API}/api/items?${p}`);
  }

  function imgTag(src, alt){
    if(!src) return `<div class="thumb ph">No image</div>`;
    return `<img class="thumb" src="${src}" alt="${alt||""}" loading="lazy"
              onerror="this.replaceWith(Object.assign(document.createElement('div'),{className:'thumb ph',innerText:'No image'}))">`;
  }

  async function render(){
    el("#grid").innerHTML = '<div class="loading">Loading‚Ä¶</div>';
    try{
      const data = await loadItems();
      el("#count").textContent = `${data.total} items`;
      const html = data.items.map(it => `
        <article class="card">
          <div class="thumb-wrap">${imgTag(it.Image, it.Name)}</div>
          <div class="body">
            <h3 class="name" title="${it.Name||''}">${fmt(it.Name)}</h3>
            <div class="meta">
              <span>Category: ${fmt(it.Category)}</span>
              <span>Brand: ${fmt(it.Marca)}</span>
              <span>Location: ${fmt(it.where)}</span>
            </div>
          </div>
        </article>
      `).join("");
      el("#grid").innerHTML = html || '<div class="empty">No results</div>';
      el("#prev").disabled = state.offset<=0;
      el("#next").disabled = state.offset+state.limit>=data.total;
      window.scrollTo({top:0, behavior:'smooth'});
    }catch(e){
      el("#grid").innerHTML = `<div class="error">Load error (${e.message})</div>`;
    }
  }

  document.addEventListener("input", e=>{
    if(e.target.id==="search"){
      state.q = e.target.value.trim();
      state.offset = 0;
      render();
    }
  });
  el("#prev").onclick = ()=>{ state.offset = Math.max(0, state.offset - state.limit); render(); };
  el("#next").onclick = ()=>{ state.offset += state.limit; render(); };

  // hero buttons -> filter by category and scroll to grid
  document.addEventListener("click", (e)=>{
    const b = e.target.closest(".hero .pill");
    if(!b) return;
    state.category = b.dataset.cat || null;  // must match CSV Category values
    state.offset = 0;
    render().then(()=>{
      const y = document.querySelector(".content").offsetTop - 12;
      window.scrollTo({top:y, behavior:"smooth"});
    });
  });

  (async function init(){ await loadCats(); await render(); })();
</script>
</body>
</html>
