<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CJG ‚Äì Catalog</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

<header class="topnav">
  <div class="brand">CJG CUMONIDAD JUDIA</div>
  <div class="actions">
    <button class="icon" aria-label="Account">üßë</button>
    <button class="icon" aria-label="Search">üîç</button>
    <button class="icon" aria-label="Cart">üõçÔ∏è</button>
  </div>
</header>

<!-- Hero: only your image, no background overlay -->
<section class="hero">
  <div class="hero-inner">
    <img class="hero-img" src="./Picture1.png" alt="Hero" />
    <h2 class="hero-sub">Choose a category</h2>
  </div>
</section>

<!-- Categories bar BELOW the image -->
<section class="cats-bar">
  <h2>Categories</h2>
  <div id="cats" class="cats"></div>
</section>

<!-- List view container: when a category is selected, body gets .list-view -->
<main class="list">
  <aside class="side">
    <h3>Categories</h3>
    <div id="cats-side" class="cats"></div>
  </aside>

  <section class="content">
    <div class="controls">
      <input id="search" placeholder="Search by name / brand / location" />
      <span id="count"></span>
      <div class="pager">
        <button id="prev">‚Äπ Prev</button>
        <button id="next">Next ‚Ä∫</button>
      </div>
    </div>
    <div id="grid" class="grid"></div>
  </section>
</main>

<footer class="foot">Live data from API</footer>

<!-- Modal for item details -->
<dialog id="item-modal" class="modal">
  <form method="dialog" class="modal-card">
    <button class="modal-close" aria-label="Close">‚úï</button>
    <div class="modal-body">
      <img id="m-img" alt="" />
      <div class="modal-info">
        <h3 id="m-name"></h3>
        <p><strong>Category:</strong> <span id="m-cat"></span></p>
        <p><strong>Brand:</strong> <span id="m-brand"></span></p>
        <p><strong>Location:</strong> <span id="m-where"></span></p>
        <p id="m-desc"></p>
      </div>
    </div>
  </form>
</dialog>

<script>
  const API = "";
  let state = { q:"", category:null, offset:0, limit:24, itemsCache:[] };

  const el  = s => document.querySelector(s);
  const fmt = s => s || "‚Äî";

  async function j(u){
    const r = await fetch(u);
    if(!r.ok) throw new Error(r.status + " " + r.statusText);
    return r.json();
  }

  // render cats into both top bar and sidebar
  function renderCats(cats){
    const html = cats.map(c => `
      <button class="chip" data-val="${c.category}">
        <span class="dot" style="--h:${Math.abs((c.category||'').length*23)%360}"></span>
        ${c.category} <span class="cnt">${c.count ?? ""}</span>
      </button>
    `).join("");
    el("#cats").innerHTML = html;
    el("#cats-side").innerHTML = html;

    // attach handlers in both places
    [el("#cats"), el("#cats-side")].forEach(root=>{
      root.querySelectorAll(".chip").forEach(b=>{
        b.onclick = ()=>{
          state.category = b.dataset.val || null;
          state.offset = 0;
          document.body.classList.add("list-view"); // move cats left
          root.querySelectorAll(".chip").forEach(x=>x.classList.remove("active"));
          b.classList.add("active");
          render();
          el(".content").scrollIntoView({behavior:"smooth"});
        };
      });
    });
  }

  async function loadCats(){
    const cats = await j(`${API}/api/categories`);
    renderCats(cats);
  }

  async function loadItems(){
    const p = new URLSearchParams();
    if(state.q)         p.set('q', state.q);
    if(state.category)  p.set('category', state.category);
    p.set('limit',  state.limit);
    p.set('offset', state.offset);
    const data = await j(`${API}/api/items?${p}`);
    state.itemsCache = data.items || [];
    return data;
  }

  function imgTag(src, alt){
    if(!src) return `<div class="thumb ph">No image</div>`;
    return `<img class="thumb" src="${src}" alt="${alt||""}" loading="lazy"
      onerror="this.replaceWith(Object.assign(document.createElement('div'),{className:'thumb ph',innerText:'No image'}))">`;
  }

  async function render(){
    if(!state.category){
      el("#grid").innerHTML = '<div class="empty">Select a category to view</div>';
      el("#count").textContent = "";
      return;
    }
    el("#grid").innerHTML = '<div class="loading">Loading‚Ä¶</div>';
    try{
      const data = await loadItems();
      el("#count").textContent = `${data.total} items`;
      const html = data.items.map((it, idx) => `
        <article class="card" data-idx="${idx}">
          <div class="thumb-wrap">${imgTag(it.Image, it.Name)}</div>
          <div class="body">
            <h3 class="name" title="${it.Name||''}">${fmt(it.Name)}</h3>
            <div class="meta">
              <span>Category: ${fmt(it.Category)}</span>
              <span>Brand: ${fmt(it.Marca)}</span>
              <span>Location: ${fmt(it.where)}</span>
            </div>
          </div>
        </article>
      `).join("");
      el("#grid").innerHTML = html || '<div class="empty">No results</div>';
      el("#prev").disabled = state.offset<=0;
      el("#next").disabled = state.offset+state.limit>=data.total;

      el("#grid").querySelectorAll(".card").forEach(card=>{
        card.onclick = ()=>{
          const idx = Number(card.dataset.idx);
          const it = state.itemsCache[idx] || {};
          openModal(it);
        };
      });
    }catch(e){
      el("#grid").innerHTML = `<div class="error">Load error (${e.message})</div>`;
    }
  }

  document.addEventListener("input", e=>{
    if(e.target.id==="search"){
      state.q = e.target.value.trim();
      state.offset = 0;
      render();
    }
  });
  el("#prev").onclick = ()=>{ state.offset = Math.max(0, state.offset - state.limit); render(); };
  el("#next").onclick = ()=>{ state.offset += state.limit; render(); };

  function openModal(it){
    const m = el("#item-modal");
    el("#m-img").src = it.Image || "";
    el("#m-img").alt = it.Name || "";
    el("#m-name").textContent  = fmt(it.Name);
    el("#m-cat").textContent   = fmt(it.Category);
    el("#m-brand").textContent = fmt(it.Marca);
    el("#m-where").textContent = fmt(it.where);
    el("#m-desc").textContent  = fmt(it.Description || it.desc || "");
    if(typeof m.showModal === "function"){ m.showModal(); } else { m.setAttribute("open",""); }
  }
  el(".modal-close").onclick = ()=> el("#item-modal").close?.();

  (async function init(){ await loadCats(); await render(); })();
</script>
</body>
</html>
